<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OSTI — C4 Architecture</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg-deep: #1a1a2e;
      --bg-panel: #16213e;
      --bg-card: #1e2d4a;
      --bg-hover: #243555;
      --text-primary: #e8f5e9;
      --text-muted: #a0b4a8;
      --text-dim: #6b8075;
      --green-dark: #2d6a4f;
      --green-mid: #40916c;
      --green-light: #52b788;
      --green-pale: #95d5b2;
      --accent-gold: #f0c040;
      --accent-blue: #5090e0;
      --accent-purple: #9060d0;
      --radius: 8px;
      --radius-lg: 12px;
      --shadow: 0 4px 24px rgba(0,0,0,0.4);
      --transition: 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    html { font-size: 15px; scroll-behavior: smooth; }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--bg-deep);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* HEADER */
    .header {
      background: linear-gradient(135deg, var(--bg-panel) 0%, var(--bg-deep) 100%);
      border-bottom: 2px solid var(--green-dark);
      padding: 1.5rem 2rem;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(12px);
    }

    .header-logo {
      width: 48px; height: 48px;
      background: linear-gradient(135deg, var(--green-mid), var(--green-light));
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.4rem; font-weight: 800; color: var(--bg-deep);
      flex-shrink: 0;
      box-shadow: 0 0 20px rgba(82,183,136,0.3);
    }

    .header-text h1 {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--green-pale), var(--green-light));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .header-text p { font-size: 0.85rem; color: var(--text-muted); margin-top: 2px; }

    .header-badges {
      margin-left: auto;
      display: flex; gap: 0.6rem; flex-wrap: wrap;
    }
    .badge {
      padding: 0.25rem 0.7rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      background: rgba(82,183,136,0.15);
      border: 1px solid var(--green-dark);
      color: var(--green-pale);
      white-space: nowrap;
    }

    /* TAB NAV */
    .tab-bar {
      display: flex;
      gap: 0;
      background: var(--bg-panel);
      border-bottom: 1px solid rgba(82,183,136,0.15);
      overflow-x: auto;
      scrollbar-width: none;
    }
    .tab-bar::-webkit-scrollbar { display: none; }

    .tab-btn {
      padding: 0.85rem 1.4rem;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 0.88rem;
      font-weight: 500;
      white-space: nowrap;
      position: relative;
      transition: color var(--transition), background var(--transition);
      font-family: inherit;
    }
    .tab-btn:hover {
      color: var(--green-pale);
      background: rgba(82,183,136,0.05);
    }
    .tab-btn.active {
      color: var(--green-light);
      background: rgba(82,183,136,0.1);
    }
    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 2px;
      background: var(--green-light);
      border-radius: 2px 2px 0 0;
    }

    /* MAIN */
    .main { padding: 2rem; max-width: 1400px; margin: 0 auto; }

    .tab-panel { display: none; animation: fadeIn 0.35s ease; }
    .tab-panel.active { display: block; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .section-title {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 0.4rem;
      background: linear-gradient(90deg, var(--green-pale), var(--green-light));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .section-subtitle {
      color: var(--text-muted);
      font-size: 0.95rem;
      margin-bottom: 1.8rem;
    }

    /* DIAGRAM AREA */
    .diagram-container {
      background: var(--bg-card);
      border: 1px solid rgba(82,183,136,0.12);
      border-radius: var(--radius-lg);
      padding: 2rem;
      margin-bottom: 1.5rem;
      min-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow-x: auto;
    }

    .diagram-container .mermaid {
      width: 100%;
      display: flex;
      justify-content: center;
    }

    .diagram-container .mermaid svg {
      max-width: 100%;
      height: auto;
    }

    /* DSL PANEL */
    .dsl-panel {
      background: var(--bg-card);
      border: 1px solid rgba(82,183,136,0.12);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .dsl-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.8rem 1.2rem;
      background: rgba(82,183,136,0.06);
      border-bottom: 1px solid rgba(82,183,136,0.1);
    }
    .dsl-header span {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--green-pale);
    }
    .copy-btn {
      padding: 0.3rem 0.8rem;
      border: 1px solid var(--green-dark);
      border-radius: var(--radius);
      background: transparent;
      color: var(--green-pale);
      font-size: 0.78rem;
      font-weight: 600;
      cursor: pointer;
      transition: background var(--transition), border-color var(--transition);
      font-family: inherit;
    }
    .copy-btn:hover {
      background: rgba(82,183,136,0.15);
      border-color: var(--green-light);
    }

    .dsl-output {
      padding: 1rem 1.2rem;
      font-family: 'Consolas', 'Fira Code', monospace;
      font-size: 0.82rem;
      color: var(--text-muted);
      white-space: pre;
      overflow-x: auto;
      max-height: 350px;
      line-height: 1.6;
    }

    /* LEGEND */
    .legend {
      display: flex;
      gap: 1.2rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
      padding: 0.8rem 1.2rem;
      background: var(--bg-card);
      border: 1px solid rgba(82,183,136,0.12);
      border-radius: var(--radius-lg);
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    .legend-swatch {
      width: 14px; height: 14px;
      border-radius: 3px;
      flex-shrink: 0;
    }

    /* RESPONSIVE */
    @media (max-width: 600px) {
      .header { flex-wrap: wrap; padding: 1rem; }
      .header-badges { margin-left: 0; }
      .main { padding: 1rem; }
      .diagram-container { padding: 1rem; }
    }
  </style>
</head>
<body>

<header class="header">
  <div class="header-logo">O</div>
  <div class="header-text">
    <h1>OSTI Architecture</h1>
    <p>Open Standard for Training Interoperability &mdash; C4 Model</p>
  </div>
  <div class="header-badges">
    <span class="badge">v0.1.1</span>
    <span class="badge">17 Models</span>
    <span class="badge">6 Enums</span>
    <span class="badge">105 Fields</span>
    <span class="badge">FHIR-Aligned</span>
  </div>
</header>

<nav class="tab-bar" id="tabBar">
  <button class="tab-btn active" data-level="context">System Context</button>
  <button class="tab-btn" data-level="container">Container</button>
  <button class="tab-btn" data-level="component">Component</button>
  <button class="tab-btn" data-level="dynamic">Dynamic</button>
</nav>

<main class="main">

  <!-- SYSTEM CONTEXT -->
  <div class="tab-panel active" id="panel-context">
    <h2 class="section-title">System Context (Level 1)</h2>
    <p class="section-subtitle">How OSTI fits into the broader soccer analytics ecosystem. Shows users, the OSTI library, and external systems it interacts with.</p>
    <div class="legend">
      <div class="legend-item"><div class="legend-swatch" style="background:#08427B;"></div> Person</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#1168BD;"></div> OSTI (internal)</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#999999;"></div> External system</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#707070; height:2px; width:20px; border-radius:0;"></div> Relationship</div>
    </div>
    <div class="diagram-container" id="diagram-context"></div>
    <div class="dsl-panel">
      <div class="dsl-header">
        <span>Mermaid DSL &mdash; System Context</span>
        <button class="copy-btn" data-level="context">Copy</button>
      </div>
      <pre class="dsl-output" id="dsl-context"></pre>
    </div>
  </div>

  <!-- CONTAINER -->
  <div class="tab-panel" id="panel-container">
    <h2 class="section-title">Container (Level 2)</h2>
    <p class="section-subtitle">The internal modules and artifacts that make up the OSTI schema library.</p>
    <div class="legend">
      <div class="legend-item"><div class="legend-swatch" style="background:#438DD5;"></div> Container / Module</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#08427B;"></div> Person</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#999999;"></div> External system</div>
    </div>
    <div class="diagram-container" id="diagram-container"></div>
    <div class="dsl-panel">
      <div class="dsl-header">
        <span>Mermaid DSL &mdash; Container</span>
        <button class="copy-btn" data-level="container">Copy</button>
      </div>
      <pre class="dsl-output" id="dsl-container"></pre>
    </div>
  </div>

  <!-- COMPONENT -->
  <div class="tab-panel" id="panel-component">
    <h2 class="section-title">Component (Level 3)</h2>
    <p class="section-subtitle">Internal structure of the core schema module, showing the Pydantic model hierarchy and relationships.</p>
    <div class="legend">
      <div class="legend-item"><div class="legend-swatch" style="background:#85BBF0;"></div> Component (model/enum)</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#438DD5;"></div> Container</div>
    </div>
    <div class="diagram-container" id="diagram-component"></div>
    <div class="dsl-panel">
      <div class="dsl-header">
        <span>Mermaid DSL &mdash; Component</span>
        <button class="copy-btn" data-level="component">Copy</button>
      </div>
      <pre class="dsl-output" id="dsl-component"></pre>
    </div>
  </div>

  <!-- DYNAMIC -->
  <div class="tab-panel" id="panel-dynamic">
    <h2 class="section-title">Dynamic Diagram</h2>
    <p class="section-subtitle">Key user flow: validating a session plan JSON file using the OSTI library.</p>
    <div class="legend">
      <div class="legend-item"><div class="legend-swatch" style="background:#08427B;"></div> Person</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#438DD5;"></div> Container</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#999999;"></div> External</div>
      <div class="legend-item"><div class="legend-swatch" style="background:#707070; height:2px; width:20px; border-radius:0;"></div> Numbered interaction</div>
    </div>
    <div class="diagram-container" id="diagram-dynamic"></div>
    <div class="dsl-panel">
      <div class="dsl-header">
        <span>Mermaid DSL &mdash; Dynamic</span>
        <button class="copy-btn" data-level="dynamic">Copy</button>
      </div>
      <pre class="dsl-output" id="dsl-dynamic"></pre>
    </div>
  </div>

</main>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

  mermaid.initialize({
    startOnLoad: false,
    theme: 'dark',
    c4: {
      diagramMarginY: 20
    }
  });

  const diagrams = {
    context: `C4Context
  title OSTI — System Context

  Person(coach, "Coach / Analyst", "Creates and consumes soccer training session plans")
  Person(developer, "Developer", "Builds applications that read/write session plans")

  System(osti, "OSTI Schema Library", "Python package providing Pydantic V2 models, enums, and validators for soccer session plan data. FHIR-inspired extension mechanism.")

  System_Ext(soccer_analytics, "soccer-analytics", "VLM extraction pipeline and FastAPI service that uses OSTI for session plan validation")
  System_Ext(github_pages, "GitHub Pages", "Hosts JSON Schema and architecture documentation")
  System_Ext(github_releases, "GitHub Releases", "Distributes versioned wheel packages")

  Rel(coach, soccer_analytics, "Uploads PDF session plans")
  Rel(soccer_analytics, osti, "Imports and validates against", "pip install osti")
  Rel(developer, osti, "Installs and imports", "pip install")
  Rel(osti, github_pages, "Publishes schema artifacts", "CI/CD")
  Rel(osti, github_releases, "Publishes wheel on tag", "CI/CD")

  UpdateLayoutConfig($c4ShapeInRow="3", $c4BoundaryInRow="1")`,

    container: `C4Container
  title OSTI — Container Diagram

  Person(developer, "Developer", "Imports osti package for session plan validation")

  System_Boundary(osti_boundary, "OSTI Schema Library") {
    Container(public_api, "Public API", "Python, __init__.py", "Package entry point exposing all models, enums, and SCHEMA_VERSION")
    Container(core_schema, "Core Schema", "Python, Pydantic V2", "SessionPlan, DrillBlock, DiagramInfo, TrainingElements, and 10 supporting models with 105 typed fields")
    Container(tactical, "Tactical Models", "Python, Pydantic V2", "TacticalContext, GameElement, LaneName, SituationType for Peters/Schumacher methodology")
    Container(extensions, "Extension System", "Python, Pydantic V2", "FHIR-style Extension model supporting string, int, float, bool, and object payloads")
    Container(generator, "Artifact Generator", "Python script", "scripts/generate.py — produces JSON Schema and optional LinkML YAML from Pydantic models")
    Container(tests, "Test Suite", "pytest", "31 tests covering models, examples, extensions, and round-trip serialization")
  }

  System_Ext(ci, "GitHub Actions CI", "Runs tests, generates schema, deploys to Pages, builds wheel on tags")
  System_Ext(github_pages, "GitHub Pages", "Hosts JSON Schema at /schema.json and /v0.1.1/schema.json")
  System_Ext(soccer_analytics, "soccer-analytics", "Consumer application for VLM extraction and rendering")

  Rel(developer, public_api, "from osti import SessionPlan")
  Rel(public_api, core_schema, "Re-exports models and enums")
  Rel(public_api, tactical, "Re-exports TacticalContext, enums")
  Rel(public_api, extensions, "Re-exports Extension")
  Rel(core_schema, tactical, "Imports TacticalContext")
  Rel(core_schema, extensions, "Imports Extension")
  Rel(generator, core_schema, "Calls model_json_schema()")
  Rel(ci, generator, "Runs on push/tag")
  Rel(ci, tests, "Runs pytest")
  Rel(ci, github_pages, "Deploys schema + docs")
  Rel(soccer_analytics, public_api, "pip install osti")

  UpdateLayoutConfig($c4ShapeInRow="3", $c4BoundaryInRow="1")`,

    component: `C4Component
  title OSTI Core Schema — Component Diagram

  Container_Boundary(core, "Core Schema (session_plan.py)") {
    Component(session_plan, "SessionPlan", "Pydantic BaseModel", "Root resource: id, metadata, drills, training_elements, source, extensions")
    Component(training_elements, "TrainingElements", "Pydantic BaseModel", "technical, tactical, physical, social, psychological")
    Component(metadata, "SessionMetadata", "Pydantic BaseModel", "title, category, difficulty, date, author, duration, desired_outcome")
    Component(drill_block, "DrillBlock", "Pydantic BaseModel", "name, setup, diagram, sequence, rules, coaching_points, progressions, author, drill_type")
    Component(drill_setup, "DrillSetup", "Pydantic BaseModel", "description, player_count, equipment, area_dimensions")
    Component(diagram_info, "DiagramInfo", "Pydantic BaseModel", "description, player_positions, arrows, equipment, goals, balls, zones, pitch_view")
    Component(source, "Source", "Pydantic BaseModel", "filename, page_count, extraction_timestamp")
    Component(page_annot, "PageAnnotation", "Pydantic BaseModel", "page_description, has_diagram, diagrams list")
  }

  Container_Boundary(diagram_models, "Diagram Models (session_plan.py)") {
    Component(player_pos, "PlayerPosition", "Pydantic BaseModel", "label, x, y, role, color — 0-100 Opta coords")
    Component(arrow, "MovementArrow", "Pydantic BaseModel", "start/end coords, arrow_type, from/to labels, sequence")
    Component(equipment, "EquipmentObject", "Pydantic BaseModel", "equipment_type, x, y, x2, y2, label, color")
    Component(goal, "GoalInfo", "Pydantic BaseModel", "x, y, goal_type, width_meters")
    Component(ball, "BallPosition", "Pydantic BaseModel", "x, y, label")
    Component(zone, "PitchZone", "Pydantic BaseModel", "zone_type, x1/y1/x2/y2, label, color")
    Component(pitch_view, "PitchView", "Pydantic BaseModel", "view_type, length/width meters, orientation")
  }

  Container_Boundary(tactical_mod, "Tactical Models (tactical.py)") {
    Component(tact_ctx, "TacticalContext", "Pydantic BaseModel", "methodology, game_element, lanes, situation_type, phase, numerical_advantage")
    Component(game_elem, "GameElement", "str Enum", "9 values: Counter Attack, Pressing, Build-Up Play, etc.")
    Component(lane, "LaneName", "str Enum", "5 lanes: left_wing to right_wing")
    Component(sit_type, "SituationType", "str Enum", "4 types: Frontal, Lateral, Behind, Before")
  }

  Container_Boundary(ext_mod, "Extension (extensions.py)") {
    Component(extension, "Extension", "Pydantic BaseModel", "url, name, value_string/integer/float/boolean/object")
  }

  Rel(session_plan, metadata, "contains")
  Rel(session_plan, drill_block, "contains list")
  Rel(session_plan, training_elements, "optional")
  Rel(session_plan, source, "contains")
  Rel(session_plan, extension, "extends via list")
  Rel(drill_block, drill_setup, "contains")
  Rel(drill_block, diagram_info, "contains")
  Rel(drill_block, tact_ctx, "optional")
  Rel(drill_block, extension, "extends via list")
  Rel(diagram_info, player_pos, "contains list")
  Rel(diagram_info, arrow, "contains list")
  Rel(diagram_info, equipment, "contains list")
  Rel(diagram_info, goal, "contains list")
  Rel(diagram_info, ball, "contains list")
  Rel(diagram_info, zone, "contains list")
  Rel(diagram_info, pitch_view, "optional")
  Rel(diagram_info, extension, "extends via list")
  Rel(arrow, arrow_type_enum, "uses ArrowType enum")
  Rel(equipment, equip_type_enum, "uses EquipmentType enum")
  Rel(pitch_view, pitch_view_enum, "uses PitchViewType enum")
  Rel(tact_ctx, game_elem, "uses")
  Rel(tact_ctx, lane, "uses list")
  Rel(tact_ctx, sit_type, "uses")
  Rel(page_annot, diagram_info, "contains list")

  UpdateLayoutConfig($c4ShapeInRow="4", $c4BoundaryInRow="2")`,

    dynamic: `C4Dynamic
  title Session Plan Validation Flow

  Person(dev, "Developer", "Loads and validates session plan JSON")
  Container(api, "osti package", "Python", "Public API surface")
  Container(schema, "Core Schema", "Pydantic V2", "SessionPlan model with nested validators")
  Container(tactical, "Tactical Models", "Pydantic V2", "TacticalContext, GameElement enums")
  Container(ext, "Extension System", "Pydantic V2", "FHIR-style extensions")
  ContainerDb(json_file, "Session Plan JSON", "JSON file", "Source session plan data")

  Rel(dev, json_file, "1. Reads JSON file", "json.load()")
  Rel(dev, api, "2. Calls SessionPlan.model_validate(data)")
  Rel(api, schema, "3. Delegates to Pydantic validation")
  Rel(schema, tactical, "4. Validates TacticalContext and enums")
  Rel(schema, ext, "5. Validates Extension payloads")
  Rel(api, dev, "6. Returns typed SessionPlan or ValidationError")

  UpdateLayoutConfig($c4ShapeInRow="3", $c4BoundaryInRow="1")`
  };

  /* Remove undefined enum references from component diagram
     (Mermaid C4 doesn't support referencing non-declared aliases) */
  diagrams.component = diagrams.component
    .replace(/  Rel\(arrow, arrow_type_enum.*\n/, '')
    .replace(/  Rel\(equipment, equip_type_enum.*\n/, '')
    .replace(/  Rel\(pitch_view, pitch_view_enum.*\n/, '');

  // Add enum components to the diagram models boundary instead
  diagrams.component = diagrams.component.replace(
    '  Container_Boundary(diagram_models, "Diagram Models (session_plan.py)") {',
    '  Container_Boundary(diagram_models, "Diagram Models (session_plan.py)") {\n' +
    '    Component(pitch_view_enum, "PitchViewType", "str Enum", "6 values: full_pitch, half_pitch, penalty_area, third, between_half_and_full, custom")\n' +
    '    Component(arrow_type_enum, "ArrowType", "str Enum", "7 values: run, pass, shot, dribble, cross, through_ball, movement")\n' +
    '    Component(equip_type_enum, "EquipmentType", "str Enum", "9 values: cone, mannequin, pole, gate, hurdle, mini_goal, full_goal, air_body, flag")'
  );

  // Re-add the relationships now that the aliases exist
  diagrams.component = diagrams.component.replace(
    'UpdateLayoutConfig($c4ShapeInRow="4", $c4BoundaryInRow="2")',
    '  Rel(arrow, arrow_type_enum, "uses")\n' +
    '  Rel(equipment, equip_type_enum, "uses")\n' +
    '  Rel(pitch_view, pitch_view_enum, "uses")\n\n' +
    '  UpdateLayoutConfig($c4ShapeInRow="4", $c4BoundaryInRow="2")'
  );

  let activeLevel = 'context';

  async function renderDiagram(level) {
    activeLevel = level;
    const dsl = diagrams[level];

    // Update DSL panels
    document.getElementById(`dsl-${level}`).textContent = dsl;

    // Render mermaid
    const container = document.getElementById(`diagram-${level}`);
    container.innerHTML = `<pre class="mermaid">${dsl}</pre>`;

    try {
      await mermaid.run({ nodes: container.querySelectorAll('.mermaid') });
    } catch (e) {
      console.warn('Mermaid render warning:', e);
    }

    // Update tabs
    document.querySelectorAll('.tab-btn').forEach(b =>
      b.classList.toggle('active', b.dataset.level === level)
    );

    // Update panels
    document.querySelectorAll('.tab-panel').forEach(p =>
      p.classList.toggle('active', p.id === `panel-${level}`)
    );
  }

  // Tab click handlers
  document.querySelectorAll('.tab-btn').forEach(btn =>
    btn.addEventListener('click', () => renderDiagram(btn.dataset.level))
  );

  // Copy buttons
  document.querySelectorAll('.copy-btn').forEach(btn =>
    btn.addEventListener('click', () => {
      const level = btn.dataset.level;
      navigator.clipboard.writeText(diagrams[level]).then(() => {
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = 'Copy', 1500);
      });
    })
  );

  // Pre-populate all DSL outputs
  Object.keys(diagrams).forEach(level => {
    const el = document.getElementById(`dsl-${level}`);
    if (el) el.textContent = diagrams[level];
  });

  // Initial render
  renderDiagram('context');
</script>

</body>
</html>
